Hard Ware check and debug:

before power on:
1. use DVM check is the power short circuit

2. use DVM check if all signal pin short to GND or VCC
   we found a bug, that one of mega8 pin short circut to GND, so mega8 became very hot after sevral reset,
   and mega8 eat about 200mA current, that's dangerous bug, it seems burn out a HC165(which short circuit to
   GND.) and check all signal pin to see if it's short to GND and VCC is mandatory check before powe on.

3. use DVM check the critical siganl not broken. refer to HW bug 3

重要： 上电检查

1. 检测1117前后的电源是否和地短路

2. 检查所有信号线是否和地/电源短路
  


debug log:
1. 上电电流200mA， 复位几次电流突然增加到400mA，mega8非常烫手。程序虽然能跑，但是测量极不稳定。 一般测量1-4M
   的有源晶振，其稳定度是+-1 到+-4.未知原因时,换上一片新mega, 现象依然. 遂测量信号到地的电阻,发现有一个连接HC165的pin到地短路,
   修正后一切正常. 稳定度达到正常水平.

2. 测量不稳定
   除了排除1所述的问题，后加焊相关信号线，测量较低的1.8432Mhz有源晶振，稳定度最终达到预计值（+-1到+-4）. 标称1.8432Mhz有源晶振
  测得值为在以下几个震荡1.843340， 1.843341， 1.83339， 1.843342. 


3. HW bug 3
   测量1.8432Mhz 晶振发现，从1.843174 跳跃到1.86246。 以为是计数器问题，补焊无果。在有源晶振加buffer（预放）后现象消失。虽然
  很多时候都是跳跃3k，好似与计数器没有关系。是buffer和信号传递问题，（接线都是鳄鱼夹）. 

4. HW bug 3
  困扰了很久的3khz问题终于搞定了.
  测量1.8432Mhz 晶振发现，从1.843174 跳跃到1.86246。 以为是计数器问题，补焊无果。各种改善信号的方法都不能消除这些问题. 66Mhz的时候干脆多了100多k. 
  下面是测试时长和误差的关系, 随未直接表明问题所在,也算是提供些思路. 
error   real   diff    time   diff*time
3707    117    3590     39    140010
2679    115    2564     54    138456
2246    61     2185     63    138456
1935    57     1878     73    137655
1519    53     1466     93    136338
1151    50     1101    123    135423
959     46     913     148    135124
                           avg:137352
		        patten:137352  100001 1000 1000 1000

  某些时长如(22/39 seconds, 32..34/39 seconds,反而能得到较为稳定的结果. 不管如何都不能根除3khz. 
  此心力憔悴，终得以解决。在对测量进行分步骤暂停处理时, 测量了gate信号, 发现Fdut的161 Gate信号总是3V左右,不是5V也不是0, 按说在测量结束应该是0. 这表明有断路,根本不通。导致gate无法栅住信号。。 

  最终原因在于gate信号在Ref 161下下面的转印线断路,并且用放大镜都看不清楚,只有万用表。此为根本原因表现为：短时测量准确度比较好， 1秒左右及以上, 多3k并随着闸门时长变长误差变小。 都是因为没有gate信号，导致程序从stop到读取计数器值的时间内被测信号依然再驱动计数器。 

  问题解决后1M到66M所有有源晶振测量值和标称值误差都在100HZ内(66M多谢,也在几百内), <8M的更是完全相同.  稳定度看被测频率, 参考频率24M, <24M信号基本就是+-1HZ, 并且延闸门明显稳定下来. 和之前完全不同.


5. HW bug 4
  无DUT信号的时候显示4khz上下的频率。测得信号多4khz。仔细检查信号连通，发现DUT的hc393引脚1虚焊。补焊后故障消失。无外加信号，显示频率0. 测量故障范围内的信号通断很重要，要测引脚和pcb连线确定是否有虚焊。


6. 最大的硬件bug
得吧F_dut和F_ref接的计数器交换下, 否则不是等精度的. 就是说要和被测频率同步才行.

7. 时间过去几个月, 做了新的预放, 但是工作总是不正常(2011/8/31 21:15)
开始怀疑预防有问题. 经过示波器测量(1周)..
  1)TCXO工作正常
  2)预放工作正常:达到5Vpp的幅度驱动74hc14不成文问题
  3)74hc74没有使能信号: 一直保持使能状态,或者是好是坏
所以怀疑是虚焊, 时间久了, 焊点发灰(焊接水一定要少阿...). 一开始怀疑是过孔问题,特别是tcxo的地. 补焊后确实好像好点,但是第二天又不成了. 几天后,终于想到, 74hc74使能信号受cpu控制,cpu定时器超时后禁止
74hc74,然后计算频率.关键是, 定时器用的是外部信号,tcxo. 测量了下, cpu引脚无信号... 当然定时器不超时了... 好办了. 马上发现上边的74hc393(IC1)引脚处的过孔虚焊(信号PD5/T1),补焊后问题解决.

(呼唤投板,或者雕刻机...)





